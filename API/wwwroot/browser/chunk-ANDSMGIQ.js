import{a as ae,b as u,c as se,d as le,e as de,f as ce,g as pe,h as ue,i as fe,j as be,k as _e}from"./chunk-VWK2SJE6.js";import{$ as L,Aa as oe,Ba as w,Ca as me,D as p,E as d,F as C,G as n,H as r,I as g,J as K,K as Q,L as x,M as h,N as c,O as B,P as W,T as X,U as o,V as E,W as y,Y as R,_ as V,aa as Z,f as J,ia as U,ja as D,k as F,la as ee,ma as te,n as M,o as T,oa as ie,s as b,t as _,ta as re,va as $,wa as j,y as a,ya as S,z as v,za as ne}from"./chunk-GLEX32WT.js";var A=class i{constructor(e){this.http=e}getMembers(){return this.http.get(`${S.apiUrl}admin/get-members`)}getMember(e){return this.http.get(`${S.apiUrl}admin/get-member/${e}`)}getApplicationRoles(){return this.http.get(`${S.apiUrl}admin/get-application-roles`)}addEditMember(e){return this.http.post(`${S.apiUrl}admin/add-edit-member`,e)}lockMember(e){return this.http.put(`${S.apiUrl}admin/lock-member/${e}`,{})}unlockMember(e){return this.http.put(`${S.apiUrl}admin/unlock-member/${e}`,{})}deleteMember(e){return this.http.delete(`${S.apiUrl}admin/delete-member/${e}`,{})}static \u0275fac=function(t){return new(t||i)(M(ie))};static \u0275prov=F({token:i,factory:i.\u0275fac,providedIn:"root"})};function xe(i,e){i&1&&(n(0,"tr")(1,"td",10),o(2,"No Members"),r()())}function Se(i,e){i&1&&(n(0,"span"),o(1,", "),r())}function Ee(i,e){if(i&1&&(n(0,"span"),o(1),p(2,Se,2,0,"span",8),r()),i&2){let t=e.$implicit,m=e.index,l=c().$implicit;a(),y(" ",t,""),a(),d("ngIf",m+1<l.roles.length)}}function Me(i,e){if(i&1){let t=x();n(0,"a",18),h("click",function(){b(t);let l=c().$implicit,f=c();return _(f.lockMember(l.id))}),o(1," Lock "),r()}}function Ce(i,e){if(i&1){let t=x();n(0,"a",19),h("click",function(){b(t);let l=c().$implicit,f=c();return _(f.unlockMember(l.id))}),o(1," Unlock "),r()}}function we(i,e){if(i&1){let t=x();n(0,"tr")(1,"td"),o(2),r(),n(3,"td"),o(4),V(5,"titlecase"),r(),n(6,"td"),o(7),V(8,"titlecase"),r(),n(9,"td"),o(10),V(11,"date"),r(),n(12,"td"),p(13,Ee,3,2,"span",9),r(),n(14,"td",7),p(15,Me,2,0,"a",11)(16,Ce,2,0,"a",12),r(),n(17,"td",7)(18,"div",13)(19,"button",14),g(20,"i",15),o(21," Edit "),r(),n(22,"button",16),h("click",function(){let l=b(t).$implicit,f=c(),N=X(26);return _(f.deleteMember(l.id,N))}),g(23,"i",17),o(24," Delete "),r()()()()}if(i&2){let t=e.$implicit;a(2),E(t.userName),a(2),E(L(5,9,t.firstName)),a(3),E(L(8,11,t.lastName)),a(3),E(L(11,13,t.dateCreated)),a(3),d("ngForOf",t.roles),a(2),d("ngIf",!t.isLocked),a(),d("ngIf",t.isLocked),a(3),W("routerLink","/admin/add-edit-member/",t.id,"")}}function Ae(i,e){if(i&1){let t=x();n(0,"div",20)(1,"p"),o(2),r(),n(3,"button",21),h("click",function(){b(t);let l=c();return _(l.confirm())}),o(4," Yes "),r(),n(5,"button",22),h("click",function(){b(t);let l=c();return _(l.decline())}),o(6," No "),r()()}if(i&2){let t=c();a(2),y("Are you sure you want to delete ",t.memberToDelete==null?null:t.memberToDelete.userName,"?")}}var q=class i{constructor(e,t,m){this.adminService=e;this.sharedService=t;this.modalService=m}members=[];memberToDelete;modalRef;ngOnInit(){this.adminService.getMembers().subscribe({next:e=>this.members=e}),console.log(this.members)}lockMember(e){this.adminService.lockMember(e).subscribe({next:t=>{this.handleLockUnlockFilterAndMessage(e,!0)}})}unlockMember(e){this.adminService.unlockMember(e).subscribe({next:t=>{this.handleLockUnlockFilterAndMessage(e,!1)}})}deleteMember(e,t){let m=this.findMember(e);m&&(this.memberToDelete=m,this.modalRef=this.modalService.show(t,{class:"modal-sm"}))}confirm(){this.memberToDelete&&this.adminService.deleteMember(this.memberToDelete.id).subscribe({next:e=>{this.sharedService.showNotification(!0,"Deleted",`Member of ${this.memberToDelete?.userName} has been deleted!`),this.members=this.members.filter(t=>t.id!==this.memberToDelete?.id),this.memberToDelete=void 0,this.modalRef?.hide()}})}decline(){this.memberToDelete=void 0,this.modalRef?.hide()}handleLockUnlockFilterAndMessage(e,t){let m=this.findMember(e);m&&(m.isLocked=!m.isLocked,t?this.sharedService.showNotification(!0,"Locked",`${m.userName} member has been locked`):this.sharedService.showNotification(!0,"Unlocked",`${m.userName} member has been unlocked`))}findMember(e){let t=this.members.find(m=>m.id===e);if(t)return t}static \u0275fac=function(t){return new(t||i)(v(A),v(w),v(oe))};static \u0275cmp=T({type:i,selectors:[["app-admin"]],standalone:!0,features:[R],decls:27,vars:2,consts:[["template",""],[1,"container","my-3","mt-5"],[1,"my-3"],["routerLink","/admin/add-edit-member",1,"btn","btn-outline-primary"],[1,"table-responsive"],[1,"table","table-striped"],[1,"table-warning"],[1,"text-center"],[4,"ngIf"],[4,"ngFor","ngForOf"],["colspan","7",1,"text-center"],["class","btn btn-warning btn-sm me-2",3,"click",4,"ngIf"],["class","btn btn-success btn-sm",3,"click",4,"ngIf"],["role","group",1,"btn-group"],[1,"btn","btn-primary","btn-sm","me-2",3,"routerLink"],[1,"bi","bi-pencil"],[1,"btn","btn-danger","btn-sm",3,"click"],[1,"bi","bi-trash"],[1,"btn","btn-warning","btn-sm","me-2",3,"click"],[1,"btn","btn-success","btn-sm",3,"click"],[1,"modal-body","text-center"],["type","button",1,"btn","btn-default",3,"click"],["type","button",1,"btn","btn-primary",3,"click"]],template:function(t,m){t&1&&(n(0,"div",1)(1,"div",2)(2,"a",3),o(3,"Create Member"),r()(),n(4,"div",4)(5,"table",5)(6,"thead")(7,"tr",6)(8,"th"),o(9,"Username"),r(),n(10,"th"),o(11,"First name"),r(),n(12,"th"),o(13,"Last name"),r(),n(14,"th"),o(15,"Date created"),r(),n(16,"th"),o(17,"Roles"),r(),n(18,"th",7),o(19,"Lock / Unlock"),r(),n(20,"th",7),o(21,"Actions"),r()()(),n(22,"tbody"),p(23,xe,3,0,"tr",8)(24,we,25,15,"tr",9),r()()(),p(25,Ae,7,1,"ng-template",null,0,Z),r()),t&2&&(a(23),d("ngIf",m.members.length===0),a(),d("ngForOf",m.members))},dependencies:[j,D,U,ee,te]})};var O=class i{constructor(e,t,m){this.accountService=e;this.sharedService=t;this.router=m}canActivate(){return this.accountService.user$.pipe(J(e=>e&&ne(e.jwt).role.includes("Admin")?!0:(this.sharedService.showNotification(!1,"Admin Area","Leave now!"),this.router.navigateByUrl("/"),!1)))}static \u0275fac=function(t){return new(t||i)(M(me),M(w),M($))};static \u0275prov=F({token:i,factory:i.\u0275fac,providedIn:"root"})};function ke(i,e){i&1&&(n(0,"span",31),o(1,"Add"),r())}function Ne(i,e){i&1&&(n(0,"span",31),o(1,"Update"),r())}function Ie(i,e){i&1&&(n(0,"span",32),o(1," First name is required "),r())}function Fe(i,e){i&1&&(n(0,"span",32),o(1," Last name is required "),r())}function Te(i,e){i&1&&(n(0,"span",32),o(1," Username is required "),r())}function Re(i,e){i&1&&(n(0,"span",32),o(1," Password is required "),r())}function Ve(i,e){i&1&&(n(0,"span",32),o(1," Password must be at least 6, and maximum 15 characters "),r())}function Le(i,e){i&1&&(n(0,"div")(1,"span",33),o(2,"Note:"),r(),o(3," if you don't intend to change the member password, then leave the password field empty "),r())}function Ue(i,e){if(i&1){let t=x();K(0),n(1,"input",34),h("change",function(){let l=b(t).$implicit,f=c(2);return _(f.roleOnChange(l))}),r(),n(2,"label",35),o(3),r(),Q()}if(i&2){let t,m=e.$implicit,l=c(2);a(),C("is-invalid",l.submitted&&((t=l.memberForm.get("roles"))==null?null:t.errors)),B("id",m),d("checked",l.existingMemberRoles.includes(m)),a(),B("for",m),a(),E(m)}}function De(i,e){i&1&&(n(0,"div",32),o(1," Please select at least one role "),r())}function $e(i,e){if(i&1&&(n(0,"div",36),g(1,"app-validation-messages",37),r()),i&2){let t=c(2);a(),d("errorMessages",t.errorMessages)}}function je(i,e){if(i&1){let t=x();n(0,"div",1)(1,"div",2)(2,"main",3)(3,"form",4),h("ngSubmit",function(){b(t);let l=c();return _(l.submit())}),n(4,"div",5)(5,"h3",6),p(6,ke,2,0,"span",7)(7,Ne,2,0,"span",7),o(8," Member "),r()(),n(9,"div",8),g(10,"input",9),n(11,"label",10),o(12,"First name"),r(),p(13,Ie,2,0,"span",11),r(),n(14,"div",8),g(15,"input",12),n(16,"label",13),o(17,"Last name"),r(),p(18,Fe,2,0,"span",11),r(),n(19,"div",8),g(20,"input",14),n(21,"label",15),o(22,"Username"),r(),p(23,Te,2,0,"span",11),r(),n(24,"div",8)(25,"input",16),h("change",function(){b(t);let l=c();return _(l.passwordOnChange())}),r(),n(26,"label",17),o(27,"Password"),r(),p(28,Re,2,0,"span",11)(29,Ve,2,0,"span",11)(30,Le,4,0,"div",18),r(),n(31,"div",19)(32,"div",20)(33,"label",21),o(34,"Roles:"),r()(),n(35,"div",22)(36,"div",23),p(37,Ue,4,6,"ng-container",24),r()()(),p(38,De,2,0,"div",11)(39,$e,2,1,"div",25),n(40,"div",26)(41,"div",27)(42,"div",28)(43,"button",29),o(44),r()()(),n(45,"div",27)(46,"div",28)(47,"button",30),o(48," Back to list "),r()()()()()()()()}if(i&2){let t,m,l,f,N,G,z,H,I,Y,s=c();a(3),d("formGroup",s.memberForm),a(3),d("ngIf",s.addNew),a(),d("ngIf",!s.addNew),a(3),C("is-invalid",s.submitted&&((t=s.memberForm.get("firstName"))==null?null:t.errors)),a(3),d("ngIf",s.submitted&&((m=s.memberForm.get("firstName"))==null?null:m.hasError("required"))),a(2),C("is-invalid",s.submitted&&((l=s.memberForm.get("lastName"))==null?null:l.errors)),a(3),d("ngIf",s.submitted&&((f=s.memberForm.get("lastName"))==null?null:f.hasError("required"))),a(2),C("is-invalid",s.submitted&&((N=s.memberForm.get("userName"))==null?null:N.errors)),a(3),d("ngIf",s.submitted&&((G=s.memberForm.get("userName"))==null?null:G.hasError("required"))),a(2),C("is-invalid",s.submitted&&((z=s.memberForm.get("password"))==null?null:z.errors)),a(3),d("ngIf",s.submitted&&((H=s.memberForm.get("password"))==null?null:H.hasError("required"))),a(),d("ngIf",s.submitted&&((I=s.memberForm.get("password"))==null?null:I.hasError("minlength"))||((I=s.memberForm.get("password"))==null?null:I.hasError("maxlength"))),a(),d("ngIf",!s.addNew),a(7),d("ngForOf",s.applicationRoles),a(),d("ngIf",s.submitted&&((Y=s.memberForm.get("roles"))==null?null:Y.hasError("required"))),a(),d("ngIf",s.errorMessages.length>0),a(5),y(" ",s.addNew?"Create":"Update"," Member ")}}var k=class i{constructor(e,t,m,l,f){this.adminService=e;this.sharedService=t;this.formBuilder=m;this.router=l;this.activatedRoute=f}memberForm=new de({});formInitialized=!1;addNew=!0;submitted=!1;errorMessages=[];applicationRoles=[];existingMemberRoles=[];ngOnInit(){let e=this.activatedRoute.snapshot.paramMap.get("id");e?(this.addNew=!1,this.getMember(e)):this.initializeForm(void 0),this.getRoles()}getMember(e){this.adminService.getMember(e).subscribe({next:t=>{this.initializeForm(t)}})}getRoles(){this.adminService.getApplicationRoles().subscribe({next:e=>this.applicationRoles=e})}initializeForm(e){e?(this.memberForm=this.formBuilder.group({id:[e.id],firstName:[e.firstName,u.required],lastName:[e.lastName,u.required],userName:[e.userName,u.required],password:[""],roles:[e.roles,u.required]}),this.existingMemberRoles=e.roles.split(",")):this.memberForm=this.formBuilder.group({id:[""],firstName:["",u.required],lastName:["",u.required],userName:["",u.required],password:["",[u.required,u.minLength(6),u.maxLength(15)]],roles:["",u.required]}),this.formInitialized=!0}passwordOnChange(){this.addNew==!1&&(this.memberForm.get("password")?.value?this.memberForm.controls.password.setValidators([u.required,u.minLength(6),u.maxLength(15)]):this.memberForm.get("password")?.clearValidators(),this.memberForm.controls.password.updateValueAndValidity())}roleOnChange(e){let t=this.memberForm.get("roles")?.value.split(","),m=t.indexOf(e);m!==-1?t.splice(m,1):t.push(e),t[0]===""&&t.splice(0,1),this.memberForm.controls.roles.setValue(t.join(","))}submit(){this.submitted=!0,this.errorMessages=[],this.memberForm.valid&&this.adminService.addEditMember(this.memberForm.value).subscribe({next:e=>{this.sharedService.showNotification(!0,e.value.titile,e.value.message),this.router.navigateByUrl("/admin")},error:e=>{e.error.errors?this.errorMessages=e.error.errors:this.errorMessages.push(e.error)}})}static \u0275fac=function(t){return new(t||i)(v(A),v(w),v(fe),v($),v(re))};static \u0275cmp=T({type:i,selectors:[["app-add-edit-member"]],standalone:!0,features:[R],decls:1,vars:1,consts:[["class","d-flex justify-content-center",4,"ngIf"],[1,"d-flex","justify-content-center"],[1,"col-12","col-lg-5"],[1,"form-signin"],["autocomplete","off",3,"ngSubmit","formGroup"],[1,"text-center","mb-4"],[1,"mb-3","font-weight-normal"],["class","text-warning",4,"ngIf"],[1,"form-floating","mb-3"],["formControlName","firstName","type","text","placeholder","First Name",1,"form-control"],["for","firstName"],["class","text-danger",4,"ngIf"],["formControlName","lastName","type","text","placeholder","Last Name",1,"form-control"],["for","lastName"],["formControlName","userName","type","text","placeholder","Username",1,"form-control"],["for","userName"],["formControlName","password","type","text","placeholder","Password",1,"form-control",3,"change"],["for","password"],[4,"ngIf"],[1,"row"],[1,"col-2"],["for","roles"],[1,"col-10"],[1,"btn-group"],[4,"ngFor","ngForOf"],["class","form-floatin",4,"ngIf"],[1,"row","my-4"],[1,"col-6"],[1,"d-grid"],["type","submit",1,"btn","btn-block","btn-info"],["type","button","routerLink","/admin",1,"btn","btn-block","btn-danger"],[1,"text-warning"],[1,"text-danger"],[1,"text-info","fw-bold"],["type","checkbox",1,"btn-check",3,"change","id","checked"],[1,"btn","btn-outline-primary",3,"for"],[1,"form-floatin"],[3,"errorMessages"]],template:function(t,m){t&1&&p(0,je,49,21,"div",0),t&2&&d("ngIf",m.formInitialized)},dependencies:[D,U,_e,be,ce,ae,se,le,pe,ue,j]})};var dt=[{path:"",runGuardsAndResolvers:"always",canActivate:[O],children:[{path:"",component:q},{path:"add-edit-member",component:k},{path:"add-edit-member/:id",component:k}]}];export{dt as adminRoutes};
